<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>kjxqz.com</title>
  <meta name="description" content="Word game word solver.">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <style>
   html {
       font-family: monospace;
       font-size: 24px;
       letter-spacing: 0.03125em;
       overflow-y: scroll;
   }
   .content {
       margin: 0 auto;
       max-width: 480px;
   }
   h1 {
       font-size: 0.75em;
       text-align: center;
   }
   input[name="query"] {
       border: 0.09375em solid black;
       border-radius: 0;
       box-sizing: border-box;
       font-family: inherit;
       font-size: inherit;
       font-weight: bold;
       letter-spacing: 0.125em;
       padding: 0.25em;
       width: 100%;
   }
   input:focus {
       outline: none;
   }
   p {
       margin: 0.5em;
   }
   .word {
       font-size: 0.75em;
       margin: 0.125em;
   }
  </style>
</head>
<body>
  <div class="content">
    <h1>kjxqz.com</h1>
    <div class="wrapper">
      <input id="query" name="query" type="text" oninput="update()"
             autocorrect="off" autocapitalize="none">
    </div>
    <div id="output"></div>
  </div>
  <script src="/dawg.js"></script>
  <script>
    function update() {
        var options = parse();
        var results = matches(options);
        draw(options, results);
    }
    function parse() {
        var options = new Map([['letters', ''], ['contains', '']]);
        var input_query = document.getElementById('query');
        var query = input_query.value;
        var lower_query = query.toLowerCase();
        var parts = lower_query.split(/\s+/);
        var letters = parts.shift() || '';
        letters = /^[a-z?]{1,12}$/.test(letters) ? letters : '';
        letters = (letters.match(/\?/g) || []).length <= 2 ? letters : '';
        options.set('letters', letters);
        var contains = parts.shift() || '';
        contains = /^[a-z]{1,12}$/.test(contains) ? contains : '';
        options.set('contains', contains);
        return options;
    }
    function draw(options, results) {
        var parts = [
            '<p>',
            '<span class="word">',
            'Letters: ' + options.get('letters'),
            '</span>',
        ];

        if (options.get('contains').length > 0) {
            parts.push('<br>');
            parts.push('<span class="word">');
            parts.push('Contains: ' + options.get('contains'));
            parts.push('</span>');
        }
        parts.push('</p>');

        var last = -1;

        for (var index = 0; index < results.length; index += 1) {
            var word = results[index];

            if (word.length != last) {
                if (index > 0) {
                    parts.push('</p>');
                }
                parts.push('<p>');
                last = word.length;
            }
            parts.push('<span class="word">' + word + '</span>');
        }
        parts.push('</p>');

        var output = document.getElementById('output');
        output.innerHTML = parts.join('\n');
    }
    function matches(options) {
        var value = [];
        var letters = Array.from(options.get('letters'));
        var alphabet = Array.from('abcdefghijklmnopqrstuvwxyz');
        var results = [];

        function helper(state) {
            var branch = dawg[state];

            if ('$' in branch) {
                var result = value.join('');
                results.push(result);
            }

            for (var index = 0; index < letters.length; index += 1) {
                var letter = letters.pop();
                var choices = letter == '?' ? alphabet : [letter];

                for (choice of choices) {
                    if (choice in branch) {
                        value.push(choice);
                        state = branch[choice];
                        helper(state);
                        value.pop();
                    }
                }
                letters.splice(0, 0, letter);
            }
        }

        helper('0');

        results.sort(function(alpha, beta) {
            return (beta.length - alpha.length
                || alpha.localeCompare(beta));
        });

        return results.filter(function (element, index, results) {
            return index == 0 || results[index - 1] != element;
        });
    }
  </script>
</body>
</html>
